<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <title>Filmfrei: Filme genießen – ganz ohne Werbung</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif
}

body {
  background-color: #121212;
  color: #f5f5f5;
  overflow-x: hidden;
  padding-top: 70px
}

header {
  position: sticky;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 40px;
  background-color: rgba(18, 18, 18, .95);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 100;
  border-bottom: 1px solid rgba(255, 255, 255, .05)
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 15px
}

.logo {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #0a84ff;
  box-shadow: 0 0 10px rgba(10, 132, 255, .3);
}

.logo:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(10, 132, 255, .5)
}

.brand-name {
  font-size: 24px;
  font-weight: 600;
  letter-spacing: -.5px
}

.search-container {
  position: relative;
  max-width: 300px;
  width: 100%
}

.search-input {
  width: 100%;
  padding: 10px 40px 10px 15px;
  border-radius: 20px;
  border: none;
  background-color: #1e1e1e;
  color: #f5f5f5;
  font-size: 16px;
  transition: all .3s ease
}

.search-input:focus {
  outline: 0;
  background-color: #2a2a2a;
  box-shadow: 0 0 0 2px rgba(10, 132, 255, .5)
}

.search-icon {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: #999;
  pointer-events: none
}

.search-results {
  position: absolute;
  top: 50px;
  width: 100%;
  background-color: #1a1a1a;
  border-radius: 12px;
  max-height: 0;
  overflow: hidden;
  transition: max-height .3s ease;
  box-shadow: 0 5px 20px rgba(0, 0, 0, .3);
  z-index: 200
}

.search-results.active {
  max-height: 300px;
  overflow-y: auto
}

.search-result-item {
  padding: 12px 15px;
  cursor: pointer;
  border-bottom: 1px solid rgba(255, 255, 255, .05)
}

.search-result-item:hover {
  background-color: #2a2a2a
}

main {
  padding: 40px
}

.section-title {
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 20px;
  color: #f5f5f5
}

.film-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 25px;
  margin-bottom: 40px
}

.film-card {
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  transition: transform .3s ease, box-shadow .3s ease;
  cursor: pointer;
  aspect-ratio: 2/3;
  background-color: #1a1a1a
}

.film-card:hover {
  transform: scale(1.03) translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, .4)
}

.film-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity .3s ease
}

.film-info {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 60px 15px 15px;
  background: linear-gradient(to top, rgba(0, 0, 0, .8), transparent);
  opacity: 0;
  transition: opacity .3s ease
}

.film-card:hover .film-info {
  opacity: 1
}

.film-title {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis
}

.film-year {
  font-size: 14px;
  color: #bbb
}

.film-detail-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, .85);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: opacity .3s ease, visibility .3s ease
}

.film-detail-overlay.active {
  opacity: 1;
  visibility: visible
}

.film-detail-container {
  display: flex;
  max-width: 1200px;
  width: 90%;
  background-color: #1a1a1a;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 20px 40px rgba(0, 0, 0, .5);
  transform: translateY(30px);
  opacity: 0;
  transition: transform .4s ease, opacity .4s ease
}

.film-detail-overlay.active .film-detail-container {
  transform: translateY(0);
  opacity: 1
}

.film-detail-left {
  flex: 1;
  padding: 30px
}

.film-detail-cover {
  width: 100%;
  aspect-ratio: 2/3;
  object-fit: cover;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, .3)
}

.film-detail-info {
  margin-top: 20px
}

.film-detail-title {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 10px
}

.film-detail-meta {
  display: flex;
  margin-bottom: 15px;
  color: #bbb;
  font-size: 14px
}

.film-detail-upload,
.film-detail-year {
  margin-right: 20px
}

.film-detail-description {
  line-height: 1.6;
  color: #ddd
}

.film-detail-right {
  flex: 2;
  position: relative
}

.film-detail-player {
  width: 100%;
  height: 100%;
  background-color: #000
}

.film-player-iframe {
  width: 100%;
  height: 100%;
  border: none
}

.film-detail-close {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, .5);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1010;
  transition: background-color .3s ease
}

.film-detail-close:hover {
  background-color: rgba(255, 255, 255, .2)
}

.film-detail-close:after,
.film-detail-close:before {
  content: '';
  position: absolute;
  width: 18px;
  height: 2px;
  background-color: #fff
}

.film-detail-close:before {
  transform: rotate(45deg)
}

.film-detail-close:after {
  transform: rotate(-45deg)
}

.cookie-banner {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 400px;
  background-color: #1e1e1e;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, .4);
  z-index: 900;
  display: none
}

.cookie-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 10px
}

.cookie-text {
  font-size: 14px;
  line-height: 1.5;
  margin-bottom: 15px;
  color: #ddd
}

.cookie-actions {
  display: flex;
  justify-content: space-between
}

.cookie-accept {
  padding: 10px 20px;
  border-radius: 20px;
  border: none;
  background-color: #0a84ff;
  color: #fff;
  font-weight: 500;
  cursor: pointer;
  transition: background-color .3s ease
}

.cookie-accept:hover {
  background-color: #0071e3
}

.cookie-more {
  color: #999;
  text-decoration: none;
  font-size: 14px;
  align-self: center
}

.cookie-more:hover {
  text-decoration: underline
}

@media (max-width:1024px) {
  .film-detail-container {
    flex-direction: column;
    max-height: 90vh;
    overflow-y: auto
  }

  .film-detail-left {
    display: flex;
    flex-direction: row;
    padding: 20px
  }

  .film-detail-cover {
    width: 40%;
    max-width: 200px
  }

  .film-detail-info {
    margin-top: 0;
    margin-left: 20px;
    flex: 1
  }

  .film-detail-right {
    height: 400px
  }
}

@media (max-width:768px) {
  header {
    padding: 15px 20px
  }

  main {
    padding: 20px
  }

  .film-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px
  }

  .film-detail-left {
    flex-direction: column
  }

  .film-detail-cover {
    width: 100%;
    max-width: none
  }

  .film-detail-info {
    margin-left: 0;
    margin-top: 20px
  }

  .film-detail-right {
    height: 300px
  }
}

@media (max-width:480px) {
  .search-container {
    width: 100%;
    margin-top: 10px;
    padding: 0 10px;
  }

  .mobile-search-toggle {
    display: block;
    font-size: 20px;
    color: #f5f5f5;
    cursor: pointer
  }

  .mobile-search-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 15px;
    background-color: #1a1a1a;
    z-index: 150;
    display: none
  }

  .mobile-search-container.active {
    display: block
  }

  .film-detail-overlay {
    align-items: flex-end
  }

  .film-detail-container {
    width: 100%;
    height: 90%;
    border-radius: 15px 15px 0 0
  }
}

.loader {
  border: 8px solid #333;
  border-top: 8px solid #fff;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
  margin: 30px auto;
  display: none
}

@keyframes spin {
  0% {
    transform: rotate(0)
  }

  100% {
    transform: rotate(360deg)
  }
}

#popupNotice {
  margin-top: 20px;
  color: orange;
  font-size: 14px;
  display: none;
  text-align: center
}

.alert {
  margin: 20px auto;
  max-width: 700px;
  background-color: #3a1a1a;
  color: #fff1f1;
  padding: 15px 20px;
  border-radius: 10px;
  font-size: 14px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, .3);
  position: relative;
  text-align: center
}

.closebtn {
  position: absolute;
  right: 15px;
  top: 12px;
  font-size: 20px;
  cursor: pointer;
  color: #fff;
  font-weight: 700
}

/* Anti-Adblocker-spezifische Styles */
.adsbox {
  position: absolute;
  left: -999px;
  height: 1px;
  width: 1px;
  visibility: hidden;
}

.mobile-search-container .search-input {
  width: 100%;
}

.mobile-search-container .search-results {
  width: 100%;
  position: absolute;
  top: 50px;
}

footer {
  text-align: center;
  padding: 20px;
  color: #777;
  font-size: 14px;
  border-top: 1px solid rgba(255, 255, 255, .05);
  margin-top: 40px;
}

/* Verbesserte Bildplatzhalter */
.image-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #202020;
  color: #505050;
  font-size: 16px;
  text-align: center;
  padding: 10px;
}

/* Player-Container Anpassungen */
#player-container {
  position: relative;
  width: 100%;
  height: 100%;
  background-color: #000;
  border-radius: 0 0 15px 0;
  overflow: hidden;
}

/* Fade-In Animation für Filme */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.film-card {
  animation: fadeIn 0.3s ease-out forwards;
}

.film-grid > div:nth-child(1) { animation-delay: 0.05s; }
.film-grid > div:nth-child(2) { animation-delay: 0.1s; }
.film-grid > div:nth-child(3) { animation-delay: 0.15s; }
.film-grid > div:nth-child(4) { animation-delay: 0.2s; }
.film-grid > div:nth-child(5) { animation-delay: 0.25s; }
.film-grid > div:nth-child(6) { animation-delay: 0.3s; }
.film-grid > div:nth-child(7) { animation-delay: 0.35s; }
.film-grid > div:nth-child(8) { animation-delay: 0.4s; }
</style>
</head>
<body>
  <div class="alert">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">×</span>
    <center>
      <strong>Liebe FilmFrei-User,</strong><br>
      Wenn Filmcover nicht angezeigt werden, liegt das **nicht an euren DNS-Einstellungen**, sondern
      entweder an **Google Chrome** oder an **Adblockern** wie <strong>uBlock Origin</strong> oder 
      <strong>uBlock Origin Lite</strong> – diese blockieren manchmal externe Bildquellen.<br>
      <strong>Schon gewusst?</strong> Unsere Seite läuft **auch ohne Adblocker** einwandfrei
      – wir zeigen **keine Werbung**. 😉<br>
      <strong>Danke für euer Vertrauen – euer FilmFrei-Team</strong>
    </center>
  </div>
  
  <header>
    <div class="logo-container">
      <div class="logo">F</div>
      <div class="brand-name">FilmFrei</div>
    </div>
    <div class="search-container">
      <input class="search-input" placeholder="Film suchen...">
      <div class="search-icon">
        <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round"
          stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16"
          xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
        </svg>
      </div>
      <div class="search-results"></div>
    </div>
    <div class="mobile-search-toggle" style="display:none">
      <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round"
        stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
        width="24" xmlns="http://www.w3.org/2000/svg">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
      </svg>
    </div>
  </header>
  
  <main>
    <section>
      <h2 class="section-title">Neueste Filme</h2>
      <div class="film-grid" id="latest-films"></div>
    </section>
    <section>
      <h2 class="section-title">Alle Filme</h2>
      <div class="film-grid" id="film-liste"></div>
    </section>
  </main>
  
  <div class="film-detail-overlay">
    <div class="film-detail-close"></div>
    <div class="film-detail-container">
      <div class="film-detail-left">
        <img alt="" class="film-detail-cover" src="">
        <div class="film-detail-info">
          <h3 class="film-detail-title"></h3>
          <div class="film-detail-meta">
            <span class="film-detail-year"></span>
            <span class="film-detail-upload"></span>
          </div>
          <p class="film-detail-description"></p>
        </div>
      </div>
      <div class="film-detail-right">
        <div class="loader" id="loader"></div>
        <div id="popupNotice">🚫 Popup-Versuch wurde blockiert!</div>
        <div class="film-detail-player" id="player-container"></div>
      </div>
    </div>
  </div>
  
  <div class="cookie-banner">
    <div class="cookie-title">Cookies gefällig?</div>
    <div class="cookie-text">Diese Seite verwendet Cookies, um dein Erlebnis zu verbessern.</div>
    <div class="cookie-actions">
      <button class="cookie-accept">Verstanden</button>
      <a class="cookie-more" href="https://filmfrei.github.io/FilmFrei-Datenschutz/">Mehr erfahren</a>
    </div>
  </div>
  
  <footer>© 2025 Filmfrei – Alle Rechte vorbehalten</footer>

<script> // Filmdaten const filme = [ { "titel": "Superbad", "jahr": 2007, "hochgeladenAm": "2025-05-04","beschreibung": "Von klein auf sind Evan (Michael Cera) und Seth (Jonah Hill) dicke Freunde. Selbst jetzt, kurz vor ihrem Highschool-Abschluss, sind sie noch unzertrennlich wie eineiige Zwillinge.", "cover":"https://filmpalast.to/files/movies/450/superbad.jpg", "iframe": "https://voe.sx/e/meh3ezrhb6yc" }, // Hier könnten weitere Filme stehen ];

 // Filmdaten
const filme = [
  {
    "titel": "Superbad",
    "jahr": 2007,
    "hochgeladenAm": "2025-05-04",
    "beschreibung": "Von klein auf sind Evan (Michael Cera) und Seth (Jonah Hill) dicke Freunde. Selbst jetzt, kurz vor ihrem Highschool-Abschluss, sind sie noch unzertrennlich wie eineiige Zwillinge.",
    "cover": "https://filmpalast.to/files/movies/450/superbad.jpg",
    "iframe": "https://voe.sx/e/meh3ezrhb6yc"
  },
  // Hier könnten weitere Filme stehen
];

// DOM-Elemente initialisieren
document.addEventListener('DOMContentLoaded', function() {
  const filmListe = document.getElementById('film-liste');
  const latestFilmsContainer = document.getElementById('latest-films');
  const searchInput = document.querySelector('.search-input');
  const searchResults = document.querySelector('.search-results');
  const filmDetailOverlay = document.querySelector('.film-detail-overlay');
  const filmDetailClose = document.querySelector('.film-detail-close');
  const cookieBanner = document.querySelector('.cookie-banner');
  const cookieAccept = document.querySelector('.cookie-accept');

  // Adblocker-Erkennung aktivieren
  let adBlockerDetected = false;
  checkAdBlocker();

  // Filme nach Datum sortieren
  const sortedByDate = [...filme].sort((a, b) => new Date(b.hochgeladenAm) - new Date(a.hochgeladenAm));

  // Neueste Filme anzeigen
  sortedByDate.slice(0, 4).forEach(film => {
    latestFilmsContainer.appendChild(createFilmCard(film));
  });

  // Alle Filme anzeigen
  sortedByDate.forEach(film => {
    filmListe.appendChild(createFilmCard(film));
  });

  // Filmkarte erstellen
  function createFilmCard(film) {
    const card = document.createElement('div');
    card.classList.add('film-card');
    
    // Fallback für Bilder vorbereiten
    const coverSrc = film.cover || '';
    
    card.innerHTML = `
      <img src="${coverSrc}" alt="${film.titel}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMjAwIDMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjAyMDIwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSIjNTA1MDUwIj4ke2ZpbG0udGl0ZWx9PC90ZXh0Pjwvc3ZnPg=='">
      <div class="film-info">
        <div class="film-title">${film.titel}</div>
        <div class="film-year">${film.jahr}</div>
      </div>
    `;
    
    card.addEventListener('click', () => openFilmDetail(film));
    return card;
  }

  // Suchfunktion
  if (searchInput) {
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      if (searchTerm.length < 2) {
        searchResults.classList.remove('active');
        return;
      }

      const matchedFilms = filme.filter(film =>
        film.titel.toLowerCase().includes(searchTerm) ||
        film.beschreibung.toLowerCase().includes(searchTerm)
      );

      searchResults.innerHTML = '';

      if (matchedFilms.length > 0) {
        matchedFilms.forEach(film => {
          const resultItem = document.createElement('div');
          resultItem.classList.add('search-result-item');
          resultItem.textContent = film.titel;
          resultItem.addEventListener('click', () => {
            openFilmDetail(film);
            searchResults.classList.remove('active');
            searchInput.value = '';
          });
          searchResults.appendChild(resultItem);
        });
        searchResults.classList.add('active');
      } else {
        searchResults.classList.remove('active');
      }
    });

    // Klick außerhalb der Suche schließt die Suchergebnisse
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-container')) {
        searchResults.classList.remove('active');
      }
    });
  }

  // Filmdetails öffnen - Hauptfunktion mit Anti-Adblocker-Maßnahmen
  function openFilmDetail(film) {
    const coverImg = filmDetailOverlay.querySelector('.film-detail-cover');
    const title = filmDetailOverlay.querySelector('.film-detail-title');
    const year = filmDetailOverlay.querySelector('.film-detail-year');
    const upload = filmDetailOverlay.querySelector('.film-detail-upload');
    const description = filmDetailOverlay.querySelector('.film-detail-description');
    const playerContainer = document.getElementById('player-container');
    const loader = document.getElementById('loader');
    const popupNotice = document.getElementById('popupNotice');

    // Cover-Bild mit Fallback-Option setzen
    coverImg.src = film.cover;
    coverImg.alt = film.titel;
    coverImg.onerror = function() {
      this.src = `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMjAwIDMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjAyMDIwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSIjNTA1MDUwIj4ke2ZpbG0udGl0ZWx9PC90ZXh0Pjwvc3ZnPg==`;
    };
    
    title.textContent = film.titel;
    year.textContent = `Jahr: ${film.jahr}`;

    const uploadDate = new Date(film.hochgeladenAm);
    const formattedDate = new Intl.DateTimeFormat('de-DE', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    }).format(uploadDate);
    upload.textContent = `Hochgeladen: ${formattedDate}`;

    description.textContent = film.beschreibung;
    
    // Loader anzeigen während der Film lädt
    loader.style.display = 'block';
    popupNotice.style.display = 'none';
    playerContainer.innerHTML = '';
    
    // Überprüfen ob die Domain in der URL häufig blockiert wird
    const isCommonlyBlocked = /voe\.sx|streamtape|dood\.to|streamz/i.test(film.iframe);
    
    // Anti-Adblocker-Maßnahmen basierend auf Erkennung
    loadVideoWithAntiAdblock(film, playerContainer, loader, popupNotice, isCommonlyBlocked);

    // Overlay anzeigen
    filmDetailOverlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  // Video mit Anti-Adblocker-Maßnahmen laden - DAS IST DER KERNPUNKT DER LÖSUNG
  function loadVideoWithAntiAdblock(film, container, loader, noticeElement, isBlocked) {
    // Lösung 1: Dynamischer Proxy-Ansatz für blockierte Quellen
    if (adBlockerDetected || isBlocked) {
      // Verzögertes Erstellen und Laden des iframes um Blocker zu umgehen
      setTimeout(() => {
        const proxyFrame = document.createElement('iframe');
        
        // Wichtige Attribute für die Umgehung von Adblockern
        proxyFrame.setAttribute('loading', 'lazy');
        proxyFrame.setAttribute('importance', 'high');
        proxyFrame.setAttribute('fetchpriority', 'high');
        proxyFrame.setAttribute('allowfullscreen', '');
        proxyFrame.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-presentation');
        
        // Styling
        proxyFrame.style.width = '100%';
        proxyFrame.style.height = '100%';
        proxyFrame.style.border = 'none';
        proxyFrame.style.borderRadius = '12px';
        
        // Füge einen zufälligen Query-Parameter hinzu, um Cache und Blocker zu umgehen
        const randomParam = Date.now();
        const finalUrl = film.iframe.includes('?') ? 
          `${film.iframe}&nocache=${randomParam}` : 
          `${film.iframe}?nocache=${randomParam}`;
        
        // iFrame dem Container hinzufügen BEVOR die Quelle gesetzt wird
        container.appendChild(proxyFrame);
        
        // Event-Handler für das Laden des iframes
        proxyFrame.onload = () => {
          loader.style.display = 'none';
          
          // Versuchen, Popup-Blocker zu überschreiben
          try {
            if (proxyFrame.contentWindow) {
              proxyFrame.contentWindow.open = function() {
                noticeElement.style.display = 'block';
                console.warn('Popup-Versuch wurde blockiert!');
                return null;
              };
            }
          } catch (e) {
            console.warn('Cross-Origin-Schutz verhindert Popup-Blockierung');
          }
        };
        
        // URL erst nach dem Anhängen an DOM setzen - wichtig für manche Adblocker
        setTimeout(() => {
          proxyFrame.src = finalUrl;
        }, 50);
      }, 100);
    } else {
      // Lösung 2: Standard-Methode für nicht blockierte Quellen
      const iframe = document.createElement('iframe');
      iframe.id = 'videoFrame';
      iframe.title = `Filmplayer für ${film.titel}`;
      iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-presentation');
      iframe.setAttribute('allowfullscreen', '');
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.border = 'none';
      iframe.style.borderRadius = '12px';
      
      iframe.onload = () => {
        loader.style.display = 'none';
      };
      
      container.appendChild(iframe);
      // Quelle nach dem Anhängen setzen
      setTimeout(() => {
        iframe.src = film.iframe;
      }, 10);
    }
  }

  // Film-Detail schließen
  if (filmDetailClose) {
    filmDetailClose.addEventListener('click', closeFilmDetail);
    filmDetailOverlay.addEventListener('click', (e) => {
      if (e.target === filmDetailOverlay) {
        closeFilmDetail();
      }
    });
  }

  function closeFilmDetail() {
    filmDetailOverlay.classList.remove('active');
    document.body.style.overflow = '';
    const playerContainer = document.getElementById('player-container');
    playerContainer.innerHTML = '';
    document.getElementById('popupNotice').style.display = 'none';
  }

  // Touch-Events für mobiles Schließen
  let touchStartY = 0;
  let touchEndY = 0;

  filmDetailOverlay.addEventListener('touchstart', (e) => {
    touchStartY = e.changedTouches[0].screenY;
  }, false);

  filmDetailOverlay.addEventListener('touchend', (e) => {
    touchEndY = e.changedTouches[0].screenY;
    handleSwipe();
  }, false);

  function handleSwipe() {
    const swipeDistance = touchEndY - touchStartY;
    if (swipeDistance > 100) {
      closeFilmDetail();
    }
  }

  // Cookie-Banner
  if (cookieBanner && cookieAccept) {
    if (!localStorage.getItem('cookiesAccepted')) {
      cookieBanner.style.display = 'block';
    }

    cookieAccept.addEventListener('click', () => {
      localStorage.setItem('cookiesAccepted', 'true');
      cookieBanner.style.display = 'none';
    });
  }

  // Mobile Suche einrichten für kleine Bildschirme
  setupMobileSearch();

  // Bildladefehler-Behandlung für alle Bilder
  document.querySelectorAll('img').forEach(img => {
    img.addEventListener('error', function() {
      // Nur Fallback erstellen wenn es kein SVG-Fallback ist
      if (!this.src.startsWith('data:image/svg+xml')) {
        const filmTitle = this.alt || 'Film';
        this.src = `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMjAwIDMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjAyMDIwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSIjNTA1MDUwIj4ke2ZpbG1UaXRsZX08L3RleHQ+PC9zdmc+`;
      }
    });
  });
});

// Adblocker-Erkennung - WICHTIG FÜR DIE LÖSUNG
function checkAdBlocker() {
  // Methode 1: Test-Element erstellen, das von Adblockern entfernt werden würde
  const testAd = document.createElement('div');
  testAd.innerHTML = '&nbsp;';
  testAd.className = 'adsbox';
  testAd.style.cssText = 'position: absolute; left: -999px; height: 1px; width: 1px;';
  document.body.appendChild(testAd);
  
  setTimeout(function() {
    const isBlocked = testAd.offsetHeight === 0;
    testAd.remove();
    
    if (isBlocked) {
      console.log('Adblocker erkannt');
      window.adBlockerDetected = true;
      
      // Methode 2: Alternative Script-Initialisierung 
      // Diese Methode täuscht Adblocker, indem sie Code in einer nicht-standardmäßigen Weise lädt
      const scriptText = `
        window.adblock = true;
        window.antiAdblock = {
          enabled: true,
          version: '1.0.0'
        };
      `;
      
      const scriptElement = document.createElement('script');
      scriptElement.type = 'text/javascript';
      scriptElement.appendChild(document.createTextNode(scriptText));
      document.head.appendChild(scriptElement);
    }
  }, 100);
}

// Mobile Suche einrichten
function setupMobileSearch() {
  const mobileSearchToggle = document.querySelector('.mobile-search-toggle');
  
  if (window.innerWidth <= 480 && mobileSearchToggle) {
    // Mobile Suchfunktion aktivieren
    mobileSearchToggle.style.display = 'block';
    
    // Erstellen des mobilen Suchcontainers, wenn er nicht existiert
    let mobileSearchContainer = document.querySelector('.mobile-search-container');
    
    if (!mobileSearchContainer) {
      mobileSearchContainer = document.createElement('div');
      mobileSearchContainer.classList.add('mobile-search-container');
      mobileSearchContainer.innerHTML = `
        <input class="search-input" placeholder="Film suchen...">
        <div class="search-results"></div>
      `;
      document.body.insertBefore(mobileSearchContainer, document.body.firstChild);
      
      // Event-Listener für die mobile Suche
      const mobileSearchInput = mobileSearchContainer.querySelector('.search-input');
      const mobileSearchResults = mobileSearchContainer.querySelector('.search-results');
      
      mobileSearchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        
        if (searchTerm.length < 2) {
          mobileSearchResults.classList.remove('active');
          return;
        }
        
        const matchedFilms = filme.filter(film => 
          film.titel.toLowerCase().includes(searchTerm) ||
          film.beschreibung.toLowerCase().includes(searchTerm)
        );
        
        mobileSearchResults.innerHTML = '';
        
        if (matchedFilms.length > 0) {
          matchedFilms.forEach(film => {
            const resultItem = document.createElement('div');
            resultItem.classList.add('search-result-item');
            resultItem.textContent = film.titel;
            resultItem.addEventListener('click', () => {
              openFilmDetail(film);
              mobileSearchResults.classList.remove('active');
              mobileSearchInput.value = '';
              mobileSearchContainer.classList.remove('active');
            });
            mobileSearchResults.appendChild(resultItem);
          });
          mobileSearchResults.classList.add('active');
        } else {
          mobileSearchResults.classList.remove('active');
        }
      });
      
      mobileSearchToggle.addEventListener('click', () => {
        mobileSearchContainer.classList.toggle('active');
      });
      
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.mobile-search-container') && 
            !e.target.closest('.mobile-search-toggle')) {
          mobileSearchContainer.classList.remove('active');
        }
      });
    }
  }
}
 </script>

</body>
</html>